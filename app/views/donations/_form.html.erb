<%= render('layouts/errors', :object => @donation) %>

<div class="container">
  <div class="row">
    <div class="col-sm-8 col-sm-offset-2">
      <!--      Wizard container        -->
      <div class="wizard-container">
        <div class="card wizard-card ct-wizard-blue" id="wizardProfile">
          <% if params[:special] %>
            <%= form_for [@campaign, @donation], :html =>{:id => 'blabla'} do |f| %>
              <%= f.hidden_field :user_id, :value => current_user.id %>
              <%= f.hidden_field :special, :value => true %>
              <script src="https://checkout.stripe.com/checkout.js"></script>
              <div class="wizard-header">
                <h3>
                   Make a Deposit for <%= @campaign.patient_name %><br>
                   <small></small>
                </h3>
              </div>
              <ul>
                <li><a href="#recipient" data-toggle="tab"></a></li>
                <!-- <li><a href="#campaign" data-toggle="tab">Campaign</a></li> -->
                <!-- <li><a href="#address" data-toggle="tab">Address</a></li> -->
              </ul>
              <div class="tab-content">
                <div class="tab-pane" id="recipient">
                  <br />
                  <br />
                  <div class="row">
                    <div class="col-sm-3">
                    </div>
                    <div class="col-sm-6">
                      <div class="form-group">
                        <label>Deposit Amount <small></small></label>
                        <%= f.text_field :donation_amount, id: "donation_amount_field", class: "form-control", type: "text", placeholder: "$50.00", disabled: true %>
                        <%= f.hidden_field :donation_amount, :value => '50' %>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="wizard-footer">
                <div class="pull-right">
                  <input type='button' class='btn btn-next btn-fill btn-warning btn-wd btn-sm' name='next' value='Next' />
                  <input type='button' class='btn btn-finish btn-fill btn-warning btn-wd btn-sm' id="customButton" value="Donate"/>
                  <%= f.submit 'Finish', :class=>'btn btn-finish btn-fill btn-warning btn-wd btn-sm hidden', name: 'finish' %>
                </div>
                <div class="pull-left">
                  <input type='button' class='btn btn-previous btn-fill btn-default btn-wd btn-sm' name='previous' value='Previous' />
                </div>
                <div class="clearfix"></div>
              </div>
            <% end %>
          <% else %>
            <%= form_for [@campaign, @donation], :html =>{:id => 'blabla'} do |f| %>
              <%= f.hidden_field :user_id, :value => current_user.id %>
              <script src="https://checkout.stripe.com/checkout.js"></script>
              <div class="wizard-header">
                <h3>
                   Make a Deposit for <%= @campaign.patient_name %><br>
                   <small></small>
                </h3>
              </div>
              <ul>
                <li><a href="#recipient" data-toggle="tab"></a></li>
                <!-- <li><a href="#campaign" data-toggle="tab">Campaign</a></li> -->
                <!-- <li><a href="#address" data-toggle="tab">Address</a></li> -->
              </ul>
              <div class="tab-content">
                <div class="tab-pane" id="recipient">
                  <br />
                  <br />
                  <div class="row">
                    <div class="col-sm-3">
                    </div>
                    <div class="col-sm-6">
                      <div class="form-group">
                        <label>Deposit Amount <small></small></label>
                        <%= f.text_field :donation_amount, id: "donation_amount_field", class: "form-control", type: "text", placeholder: "Enter Deposit Amount" %>
                      </div>
                    </div>
                  </div>
                  <br />
                  <div class="row">
                    <div class="col-sm-10-offset-1">
                      *Out of every deposit made to a campaign, a 5 percent MedStylist fee is assessed

                      that covers all of our services in helping the recipient find suitable clothing, footwear, or

                      accessories for their medical situation as well as all costs associated with standard

                      shipping (3-5 business days) and handling.  For example, for every $100 deposited,

                      $95 goes into the recipientâ€™s account for them to use to purchase items they

                      select with our assistance, and $5 goes for our MedStylist fee.  Additional charges will

                      only be assessed if more expedited shipping is needed or desired, with the specific

                      amount based on how quickly delivery is requested.
                    </div>
                  </div>
                </div>
              </div>
              <div class="wizard-footer">
                <div class="pull-right">
                  <input type='button' class='btn btn-next btn-fill btn-warning btn-wd btn-sm' name='next' value='Next' />
                  <input type='button' class='btn btn-finish btn-fill btn-warning btn-wd btn-sm' id="customButton" value="Deposit"/>
                  <%= f.submit 'Finish', :class=>'btn btn-finish btn-fill btn-warning btn-wd btn-sm hidden', name: 'finish' %>
                </div>
                <div class="pull-left">
                  <input type='button' class='btn btn-previous btn-fill btn-default btn-wd btn-sm' name='previous' value='Previous' />
                </div>
                <div class="clearfix"></div>
              </div>
            <% end %>
          <% end %>
        </div>
      </div> <!-- wizard container -->
      <br>
      <br>
    </div>
  </div>
</div>

<script>
  var handler = StripeCheckout.configure({
    key: '<%= Rails.configuration.stripe[:publishable_key] %>',
    // image: "<%= asset_path 'wyoulogo.png' %>",
    locale: 'auto',
    token: function(token) {
      $('#blabla').append($("<input type=\"hidden\" name=\"donation[card_token]\" />").val(token.id));
      $('#blabla').append($("<input type=\"hidden\" name=\"donation[email]\" />").val(token.email));
      $('#blabla').get(0).submit();
    }
  });

  $('#customButton').on('click', function(e) {
    // Open Checkout with further options
    var description_amount = 'Deposit Amount: $' + $('#donation_amount_field').val();
    handler.open({
      name: 'w/you',
      key: '<%= Rails.configuration.stripe[:publishable_key] %>',
      description: description_amount,
      amount: $('#donation_donation_amount').val() * 100
    });
    e.preventDefault();
  });

  // Close Checkout on page navigation
  $(window).on('popstate', function() {
    handler.close();
  });

  $("form").on("keypress", function (e) {
      if (e.keyCode == 13) {
          return false;
      }
  });
</script>
